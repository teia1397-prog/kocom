uart:
  id: uart_bus
  baud_rate: 9600
  data_bits: 8
  parity: NONE
  stop_bits: 1
  rx_pin: GPIO01
  tx_pin: GPIO02
  debug:
    direction: BOTH
    dummy_receiver: false
    after:
      delimiter: [0x0D, 0x0D]
    sequence:
      - lambda: |-
          ESP_LOGI("uart_debug", "Direction: %s, Bytes: %s", 
            direction == uart::UART_DIRECTION_RX ? "RX" : "TX",
            format_hex_pretty(bytes).c_str());

external_components:
  - source: github://eigger/espcomponents@latest
    components: [uartex]
    refresh: always
    
#아래 설명
# 10ms 동안 데이터 안 오면 수신 끝
# 보내기 전에 50ms 쉬기
# 500ms 안에 응답 없으면 실패
# 최대 3번 다시 보내기

uartex:
  rx_timeout: 10ms
  tx_delay: 50ms
  tx_timeout: 500ms
  tx_retry_cnt: 3

# 패킷의 앞뒤 표시
#AA 55 | 내용들... | 체크섬 | 0D 0D
  rx_header: [0xAA, 0x55]
  rx_footer: [0x0D, 0x0D]
  tx_header: [0xAA, 0x55]
  tx_footer: [0x0D, 0x0D]

  rx_checksum: add_no_header
  tx_checksum: add_no_header

  version:
    disabled: False
  error:
    disabled: False
  log:
    disabled: False

# 로그 설정 - 디버깅용
logger:
  level: DEBUG
  logs:
    uart_debug: DEBUG
    uartex: DEBUG

  # 안방 조명 1 (Room 1)
  #1번 전등 ON, 2번전등 OFF
  #AA 55 / 30 BC 00 01 00 0E 01 00 FF 00 00 00 00 00 00 00 FB / 0D0D
  #1번 전등 OFF, 2번전등 OFF
  #AA 55 / 30 BC 00 01 00 0E 01 00 00 00 00 00 00 00 00 00 FC / 0D0D
  #1번 전등 OFF, 2번 전등 ON
  #AA 55 / 30 BC 00 01 00 0E 01 00 00 FF 00 00 00 00 00 00 FB / 0D0D
  #1번 전등 OFF, 2번 전등 OFF
  #AA 55 / 30 BC 00 01 00 0E 01 00 00 00 00 00 00 00 00 00 FC / 0D0D
  #1번 전등 먼저 ON, 2번 전등 ON
  #AA 55 / 30 BC 00 01 00 0E 01 00 FF 00 00 00 00 00 00 00 FB / 0D0D 1번전등 ON
  #AA 55 / 30 BC 00 01 00 0E 01 00 FF FF 00 00 00 00 00 00 FA / 0D0D 2번전등 OM
  #1번 전등 먼저 OFF, 2번 전등 ON
  #AA 55 / 30 BC 00 01 00 0E 01 00 FF 00 00 00 00 00 00 00 FB / 0D0D 1번전등 OFF
  #AA 55 / 30 BC 00 01 00 0E 01 00 00 00 00 00 00 00 00 00 FC / 0D0D 2번전등 OFF
  #1번 전등 OFF, 2번 전등 먼저 ON
  #AA 55 / 30 BC 00 01 00 0E 01 00 00 FF 00 00 00 00 00 00 FB / 0D0D 2번전등 ON
  #AA 55 / 30 BC 00 01 00 0E 01 00 FF FF 00 00 00 00 00 00 FA / 0D0D 1번전등 ON
  #1번 전등 OFF, 2번 전등 먼저 OFF
  #AA 55 / 30 BC 00 01 00 0E 01 00 FF 00 00 00 00 00 00 00 FB / 0D0D 2번전등 OFF
  #AA 55 / 30 BC 00 01 00 0E 01 00 00 00 00 00 00 00 00 00 FC / 0D0D 1번전등 OFF


light:
  # 안방 조명 1
  - platform: uartex
    name: "Master Room Light 1"
    id: master_room_light_1
    state:
      data: [0x30, 0xd0, 0x00, 0x0e, 0x01]
      mask: [0xff, 0xf0, 0xff, 0xff, 0xff]
    state_on: { offset: 8, data: [0xff] }
    state_off: { offset: 8, data: [0x00] }
    on_turn_on:
      then:
        - lambda: |-
            if (id(master_room_light_2).remote_values.is_on()) {
              // 2번이 켜져있음 -> 둘다 ON (FA)
              static const uint8_t data[] = {0xAA, 0x55, 0x30, 0xBC, 0x00, 0x01, 0x00, 0x0E, 0x01, 0x00, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFA, 0x0D, 0x0D};
              id(uart_bus).write_array(data, 22);
            } else {
              // 2번이 꺼져있음 -> 1번만 ON (FB)
              static const uint8_t data[] = {0xAA, 0x55, 0x30, 0xBC, 0x00, 0x01, 0x00, 0x0E, 0x01, 0x00, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFB, 0x0D, 0x0D};
              id(uart_bus).write_array(data, 22);
            }
    on_turn_off:
      then:
        - lambda: |-
            if (id(master_room_light_2).remote_values.is_on()) {
              // 2번이 켜져있음 -> 2번만 유지 (FB)
              static const uint8_t data[] = {0xAA, 0x55, 0x30, 0xBC, 0x00, 0x01, 0x00, 0x0E, 0x01, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFB, 0x0D, 0x0D};
              id(uart_bus).write_array(data, 22);
            } else {
              // 둘다 OFF (FC)
              static const uint8_t data[] = {0xAA, 0x55, 0x30, 0xBC, 0x00, 0x01, 0x00, 0x0E, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFC, 0x0D, 0x0D};
              id(uart_bus).write_array(data, 22);
            }

  # 안방 조명 2
 light:
  # 안방 조명 1
  - platform: uartex
    name: "Master Room Light 1"
    id: master_room_light_1
    state:
      data: [0x30, 0xd0, 0x00, 0x0e, 0x01]
      mask: [0xff, 0xf0, 0xff, 0xff, 0xff]
    state_on: { offset: 8, data: [0xff] }
    state_off: { offset: 8, data: [0x00] }
    # 명령 전송 시 상대방 상태를 확인하는 if문 로직
    on_turn_on:
      - lambda: |-
          if (id(master_room_light_2).remote_values.is_on()) {
            // 2번이 켜져있을 때 1번을 켜면 -> 둘 다 켜짐 패킷 (FA)
            static const uint8_t p_both_on[] = {0xAA, 0x55, 0x30, 0xBC, 0x00, 0x01, 0x00, 0x0E, 0x01, 0x00, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFA, 0x0D, 0x0D};
            id(uart_bus).write_array(p_both_on, 22);
          } else {
            // 2번이 꺼져있을 때 1번을 켜면 -> 1번만 켜짐 패킷 (FB)
            static const uint8_t p_1_on[] = {0xAA, 0x55, 0x30, 0xBC, 0x00, 0x01, 0x00, 0x0E, 0x01, 0x00, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFB, 0x0D, 0x0D};
            id(uart_bus).write_array(p_1_on, 22);
          }
    on_turn_off:
      - lambda: |-
          if (id(master_room_light_2).remote_values.is_on()) {
            // 2번이 켜져있을 때 1번을 끄면 -> 2번만 유지 패킷 (FB)
            static const uint8_t p_2_on[] = {0xAA, 0x55, 0x30, 0xBC, 0x00, 0x01, 0x00, 0x0E, 0x01, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFB, 0x0D, 0x0D};
            id(uart_bus).write_array(p_2_on, 22);
          } else {
            // 둘 다 꺼질 때 -> 모두 꺼짐 패킷 (FC)
            static const uint8_t p_all_off[] = {0xAA, 0x55, 0x30, 0xBC, 0x00, 0x01, 0x00, 0x0E, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFC, 0x0D, 0x0D};
            id(uart_bus).write_array(p_all_off, 22);
          }

  # 안방 조명 2
  - platform: uartex
    name: "Master Room Light 2"
    id: master_room_light_2
    state:
      data: [0x30, 0xd0, 0x00, 0x0e, 0x01]
      mask: [0xff, 0xf0, 0xff, 0xff, 0xff]
    state_on: { offset: 9, data: [0xff] }
    state_off: { offset: 9, data: [0x00] }
    on_turn_on:
      - lambda: |-
          if (id(master_room_light_1).remote_values.is_on()) {
            // 1번이 켜져있을 때 2번을 켜면 -> 둘 다 켜짐 패킷 (FA)
            static const uint8_t p_both_on[] = {0xAA, 0x55, 0x30, 0xBC, 0x00, 0x01, 0x00, 0x0E, 0x01, 0x00, 0xFF, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFA, 0x0D, 0x0D};
            id(uart_bus).write_array(p_both_on, 22);
          } else {
            // 1번이 꺼져있을 때 2번을 켜면 -> 2번만 켜짐 패킷 (FB)
            static const uint8_t p_2_on[] = {0xAA, 0x55, 0x30, 0xBC, 0x00, 0x01, 0x00, 0x0E, 0x01, 0x00, 0x00, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFB, 0x0D, 0x0D};
            id(uart_bus).write_array(p_2_on, 22);
          }
    on_turn_off:
      - lambda: |-
          if (id(master_room_light_1).remote_values.is_on()) {
            // 1번이 켜져있을 때 2번을 끄면 -> 1번만 유지 패킷 (FB)
            static const uint8_t p_1_on[] = {0xAA, 0x55, 0x30, 0xBC, 0x00, 0x01, 0x00, 0x0E, 0x01, 0x00, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFB, 0x0D, 0x0D};
            id(uart_bus).write_array(p_1_on, 22);
          } else {
            // 둘 다 꺼질 때 -> 모두 꺼짐 패킷 (FC)
            static const uint8_t p_all_off[] = {0xAA, 0x55, 0x30, 0xBC, 0x00, 0x01, 0x00, 0x0E, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xFC, 0x0D, 0x0D};
            id(uart_bus).write_array(p_all_off, 22);
          }
            
  # 세나방 (Room 2)
  - platform: uartex
    name: "Room 2 Light"
    id: room_2_light
    state:
      data: [0x30, 0xd0, 0x00, 0x0e, 0x02]
      mask: [0xff, 0xf0, 0xff, 0xff, 0xff]
    state_on:
      offset: 8
      data: [0xff]
    state_off:
      offset: 8
      data: [0x00]
    command_on:
      data: [0x30, 0xbc, 0x00, 0x0e, 0x02, 0x00, 0x00, 0x00, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00]
      ack: [0x30, 0xdc]
    command_off:
      data: [0x30, 0xbc, 0x00, 0x0e, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00]
      ack: [0x30, 0xdc]
    command_update: 
      data: [0x30, 0xbc, 0x00, 0x0e, 0x02, 0x01, 0x00, 0x3a, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00]
      ack: [0x30, 0xdc]
    update_interval: 2h

 # 사라방 조명 (Room 3)
  - platform: uartex
    name: "Room 3 Light"
    id: room_3_light
    state:
      data: [0x30, 0xd0, 0x00, 0x0e, 0x03]
      mask: [0xff, 0xf0, 0xff, 0xff, 0xff]
    state_on:
      offset: 8
      data: [0xff]
    state_off:
      offset: 8
      data: [0x00]
    command_on:
      data: [0x30, 0xbc, 0x00, 0x0e, 0x03, 0x00, 0x00, 0x00, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00]
      ack: [0x30, 0xdc]
    command_off:
      data: [0x30, 0xbc, 0x00, 0x0e, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00]
      ack: [0x30, 0xdc]
    command_update: 
      data: [0x30, 0xbc, 0x00, 0x0e, 0x03, 0x01, 0x00, 0x3a, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00]
      ack: [0x30, 0xdc]
    update_interval: 2h

  # 알파룸 (Room 4)
# 전등 상태 확인과 제어용 패킷 설명

# 패킷 흐름 예시 (전등 ON 시)
# 1. [W] AA 55 30 BC 00 0E 04 00 00 00 FF 00 00 00 00 00 00 FD 0D 0D → 전송 패킷 (command_on)
# 2. [R] AA 55 30 DC 00 00 0E 04 00 FF 00 00 00 00 00 00 1D 0D 0D → 첫 번째 응답 패킷 (ACK/상태)
# 3. [R] AA 55 30 BC 00 01 00 0E 04 00 FF 00 00 00 00 00 00 FE 0D 0D → 내부 재전송/보정 패킷
# 4. [R] AA 55 30 DC 00 0E 04 01 00 00 FF 00 00 00 00 00 00 00 1E 0D 0D → 최종 상태 패킷 (state 확인)

#off시

# state 확인용 패킷 예시 (마지막 DC 패킷)
# [R] AA 55 / 30 DC 00 0E 04 /   01 00 00    /   FF   / 00 00 00 00 00 00 00 /      1E          / 0D 0D
#    header /  응답패킷 data  / 내부 예약 필드 / ON/OFF /      확인 바이트     / padding/checksum  / footer

# state.data
# 30      → 장치 코드
# DC      → 장치 상태 응답 (ON/OFF)
# 00 0E   → 패킷 전체 길이 계산용
# 04      → 방 번호 (4번 방)
# mask
# 0xFF    → 완전 비교, 0xF0 → 상위 4비트만 비교

# state_ 설명
# state.data
# 30      → 장치 코드
# DC      → 장치 상태 응답 (ON/OFF)
# 00 0E   → 패킷 전체 길이 계산용
# 04      → 방 번호 (4번 방)
# mask
# 0xFF    → 완전 비교, 0xF0 → 상위 4비트만 비교

# state_on / state_off
# offset = 8 → state.data 시작 기준으로 8번째 바이트를 확인
# offset 위치 = 실제 ON/OFF 값(0xFF=ON, 0x00=OFF)
# 8번재 패킷이 ff면 on / 00 이면 off 확인 
#[R]AA 55 / 30 DC 00 0E 04 / 01 00 00 / FF / 00 00 00 00 00 00 00 1E / 0D 0D(21) (두번째 응답 패킷)
#         / 0  1  2  3  4  / 5  6  7  / 8  /

# command_on
# 첫 번째 전송 패킷 사용 (BC 명령)
# [W]AA 55 / 30 BC 00 0E 04 00 00 00 FF 00 00 00 00 00 00 00 / FD / 0D0D(21)
  - platform: uartex
    name: "Alpha Room Light"
    id: Alpha_room_light
  
    state:
      data: [0x30, 0xd0, 0x00, 0x0e, 0x04]
      mask: [0xff, 0xf0, 0xff, 0xff, 0xff]
    state_on:
      offset: 8
      data: [0xff]
    state_off:
      offset: 8
      data: [0x00]

   # [W]AA 55 / 30 BC 00 0E 04 00 00 00 FF 00 00 00 00 00 00 00 / FD / 0D0D(21)
    command_on:
      data: [0x30, 0xbc, 0x00, 0x0e, 0x04, 0x00, 0x00, 0x00, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00]
      ack: [0x30, 0xdc]
   # [W]AA 55 / 30 BC 00 0E 04 00 00 00 00 00 00 00 00 00 00 00 / FE / 0D0D(21)
    command_off:
      data: [0x30, 0xbc, 0x00, 0x0e, 0x04, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00]
      ack: [0x30, 0xdc]
      
    command_update: 
      data: [0x30, 0xbc, 0x00, 0x0e, 0x04, 0x01, 0x00, 0x3a, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00]
      ack: [0x30, 0xdc]
    update_interval: 2h

  # 주방 조명 1
  - platform: uartex
    name: "Kitchen Light 1"
    id: kitchen_light_1
    state:
      data: [0x30, 0xd0, 0x00, 0x0e, 0x05]
      mask: [0xff, 0xf0, 0xff, 0xff, 0xff]
    state_on:
      offset: 8
      data: [0xff]
    state_off:
      offset: 8
      data: [0x00]
    command_on:
      data: [0x30, 0xbc, 0x00, 0x0e, 0x05, 0x00, 0x00, 0x00, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00]
      ack: [0x30, 0xdc]
    command_off:
      data: [0x30, 0xbc, 0x00, 0x0e, 0x05, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00]
      ack: [0x30, 0xdc]
    command_update: 
      data: [0x30, 0xbc, 0x00, 0x0e, 0x05, 0x01, 0x00, 0x3a, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00]
      ack: [0x30, 0xdc]
    update_interval: 2h

  # 주방 조명 2
  - platform: uartex
    name: "Kitchen Light 2"
    id: kitchen_light_2
    state:
      data: [0x30, 0xd0, 0x00, 0x0e, 0x05]
      mask: [0xff, 0xf0, 0xff, 0xff, 0xff]
    state_on:
      offset: 9
      data: [0xff]
    state_off:
      offset: 9
      data: [0x00]
    command_on:
      data: [0x30, 0xbc, 0x00, 0x0e, 0x05, 0x00, 0x00, 0x00, 0x00, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00]
      ack: [0x30, 0xdc]
    command_off:
      data: [0x30, 0xbc, 0x00, 0x0e, 0x05, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00]
      ack: [0x30, 0xdc]
    command_update: 
      data: [0x30, 0xbc, 0x00, 0x0e, 0x05, 0x01, 0x00, 0x3a, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00]
      ack: [0x30, 0xdc]
    update_interval: 2h

  # 주방 조명 3
  - platform: uartex
    name: "Kitchen Light 3"
    id: kitchen_light_3
    state:
      data: [0x30, 0xd0, 0x00, 0x0e, 0x05]
      mask: [0xff, 0xf0, 0xff, 0xff, 0xff]
    state_on:
      offset: 10
      data: [0xff]
    state_off:
      offset: 10
      data: [0x00]
    command_on:
      data: [0x30, 0xbc, 0x00, 0x0e, 0x05, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00]
      ack: [0x30, 0xdc]
    command_off:
      data: [0x30, 0xbc, 0x00, 0x0e, 0x05, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00]
      ack: [0x30, 0xdc]
    command_update: 
      data: [0x30, 0xbc, 0x00, 0x0e, 0x05, 0x01, 0x00, 0x3a, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00]
      ack: [0x30, 0xdc]
    update_interval: 2h
    
  # 거실 조명 (Room 0) - 단일 조명
  - platform: uartex
    name: "Living Room Light"
    id: living_room_light
    state:
      data: [0x30, 0xd0, 0x00, 0x0e, 0x00]
      mask: [0xff, 0xf0, 0xff, 0xff, 0xff]
    state_on:
      offset: 8
      data: [0xff]
    state_off:
      offset: 8
      data: [0x00]
    command_on:
      data: [0x30, 0xbc, 0x00, 0x0e, 0x00, 0x00, 0x00, 0x00, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00]
      ack: [0x30, 0xdc]
    command_off:
      data: [0x30, 0xbc, 0x00, 0x0e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00]
      ack: [0x30, 0xdc]


  # 안방화장실 조명 2 (Room 2)
  - platform: uartex
    name: "Master Bathroom Light 2"
    id: master_bathroom_light_2
    state:
      data: [0x30, 0xd0, 0x00, 0x0e, 0x02]
      mask: [0xff, 0xf0, 0xff, 0xff, 0xff]
    state_on:
      offset: 9
      data: [0xff]
    state_off:
      offset: 9
      data: [0x00]
    command_on:
      data: [0x30, 0xbc, 0x00, 0x0e, 0x02, 0x00, 0x00, 0x00, 0x00, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00]
      ack: [0x30, 0xdc]
    command_off:
      data: [0x30, 0xbc, 0x00, 0x0e, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00]
      ack: [0x30, 0xdc]

  # 안방화장실 조명 3 (Room 2)
  - platform: uartex
    name: "Master Bathroom Light 3"
    id: master_bathroom_light_3
    state:
      data: [0x30, 0xd0, 0x00, 0x0e, 0x02]
      mask: [0xff, 0xf0, 0xff, 0xff, 0xff]
    state_on:
      offset: 10
      data: [0xff]
    state_off:
      offset: 10
      data: [0x00]
    command_on:
      data: [0x30, 0xbc, 0x00, 0x0e, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00]
      ack: [0x30, 0xdc]
    command_off:
      data: [0x30, 0xbc, 0x00, 0x0e, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00]
      ack: [0x30, 0xdc]

 


    


  # 주방 조명 (Room 6)
  - platform: uartex
    name: "Guest Bathroom Light 1"
    id: guest_bathroom_light_1
    state:
      data: [0x30, 0xd0, 0x00, 0x0e, 0x06]
      mask: [0xff, 0xf0, 0xff, 0xff, 0xff]
    state_on:
      offset: 8
      data: [0xff]
    state_off:
      offset: 8
      data: [0x00]
    command_on:
      data: [0x30, 0xbc, 0x00, 0x0e, 0x06, 0x00, 0x00, 0x00, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00]
      ack: [0x30, 0xdc]
    command_off:
      data: [0x30, 0xbc, 0x00, 0x0e, 0x06, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00]
      ack: [0x30, 0xdc]

  - platform: uartex
    name: "Guest Bathroom Light 2"
    id: guest_bathroom_light_2
    state:
      data: [0x30, 0xd0, 0x00, 0x0e, 0x06]
      mask: [0xff, 0xf0, 0xff, 0xff, 0xff]
    state_on:
      offset: 9
      data: [0xff]
    state_off:
      offset: 9
      data: [0x00]
    command_on:
      data: [0x30, 0xbc, 0x00, 0x0e, 0x06, 0x00, 0x00, 0x00, 0x00, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00]
      ack: [0x30, 0xdc]
    command_off:
      data: [0x30, 0xbc, 0x00, 0x0e, 0x06, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00]
      ack: [0x30, 0xdc]

switch:
  # 거실화장실 환기팬 (Room 5) - 조명과 같은 디바이스지만 다른 offset 사용
  - platform: template
    name: "Guest Bathroom Ventilation"
    id: guest_bathroom_ventilation
    optimistic: true
    restore_mode: DISABLED
    turn_on_action:
      # 현재 조명 상태를 유지하면서 환기팬만 켜기
      - if:
          condition:
            light.is_on: guest_bathroom_light_1
          then:
            - if:
                condition:
                  light.is_on: guest_bathroom_light_2
                then:
                  # 조명 1,2 모두 켜져있음 + 환기팬 켜기
                  - uartex.write:
                      data:
                        [0x30, 0xbc, 0x00, 0x0e, 0x05, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00]
                      ack: [0x30, 0xdc]
                else:
                  # 조명 1만 켜져있음 + 환기팬 켜기
                  - uartex.write:
                      data:
                        [0x30, 0xbc, 0x00, 0x0e, 0x05, 0x00, 0x00, 0x00, 0xff, 0x00, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00]
                      ack: [0x30, 0xdc]
          else:
            - if:
                condition:
                  light.is_on: guest_bathroom_light_2
                then:
                  # 조명 2만 켜져있음 + 환기팬 켜기
                  - uartex.write:
                      data:
                        [0x30, 0xbc, 0x00, 0x0e, 0x05, 0x00, 0x00, 0x00, 0x00, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00]
                      ack: [0x30, 0xdc]
                else:
                  # 조명 모두 꺼져있음 + 환기팬만 켜기
                  - uartex.write:
                      data:
                        [0x30, 0xbc, 0x00, 0x0e, 0x05, 0x00, 0x00, 0x00, 0x00, 0x00, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00]
                      ack: [0x30, 0xdc]
      - logger.log: "거실화장실 환기팬 켜짐 (조명 상태 유지)"
    turn_off_action:
      # 현재 조명 상태를 유지하면서 환기팬만 끄기
      - if:
          condition:
            light.is_on: guest_bathroom_light_1
          then:
            - if:
                condition:
                  light.is_on: guest_bathroom_light_2
                then:
                  # 조명 1,2 모두 켜져있음 + 환기팬 끄기
                  - uartex.write:
                      data:
                        [0x30, 0xbc, 0x00, 0x0e, 0x05, 0x00, 0x00, 0x00, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00]
                      ack: [0x30, 0xdc]
                else:
                  # 조명 1만 켜져있음 + 환기팬 끄기
                  - uartex.write:
                      data:
                        [0x30, 0xbc, 0x00, 0x0e, 0x05, 0x00, 0x00, 0x00, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00]
                      ack: [0x30, 0xdc]
          else:
            - if:
                condition:
                  light.is_on: guest_bathroom_light_2
                then:
                  # 조명 2만 켜져있음 + 환기팬 끄기
                  - uartex.write:
                      data:
                        [0x30, 0xbc, 0x00, 0x0e, 0x05, 0x00, 0x00, 0x00, 0x00, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00]
                      ack: [0x30, 0xdc]
                else:
                  # 조명 모두 꺼져있음 + 환기팬만 끄기
                  - uartex.write:
                      data:
                        [0x30, 0xbc, 0x00, 0x0e, 0x05, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00]
                      ack: [0x30, 0xdc]
      - logger.log: "거실화장실 환기팬 꺼짐 (조명 상태 유지)"
    on_turn_on:
      - logger.log: "거실화장실 환기팬 켜짐"
    on_turn_off:
      - logger.log: "거실화장실 환기팬 꺼짐"

  # 안방화장실 환기팬 (Room 2) - 조명과 같은 디바이스지만 다른 offset 사용
  - platform: template
    name: "Master Bathroom Ventilation"
    id: master_bathroom_ventilation
    optimistic: true
    restore_mode: DISABLED
    turn_on_action:
      # 현재 조명 상태를 유지하면서 환기팬만 켜기
      - if:
          condition:
            light.is_on: room_2_light
          then:
            - if:
                condition:
                  light.is_on: master_bathroom_light_2
                then:
                  - if:
                      condition:
                        light.is_on: master_bathroom_light_3
                      then:
                        # 조명 1,2,3 모두 켜져있음 + 환기팬 켜기
                        - uartex.write:
                            data:
                              [
                                0x30,
                                0xbc,
                                0x00,
                                0x0e,
                                0x02,
                                0x01,
                                0x00,
                                0x00,
                                0xff,
                                0xff,
                                0xff,
                                0xff,
                                0x00,
                                0x00,
                                0x00,
                                0x00,
                              ]
                            ack: [0x30, 0xdc]
                      else:
                        # 조명 1,2만 켜져있음 + 환기팬 켜기
                        - uartex.write:
                            data:
                              [
                                0x30,
                                0xbc,
                                0x00,
                                0x0e,
                                0x02,
                                0x01,
                                0x00,
                                0x00,
                                0xff,
                                0xff,
                                0x00,
                                0xff,
                                0x00,
                                0x00,
                                0x00,
                                0x00,
                              ]
                            ack: [0x30, 0xdc]
                else:
                  - if:
                      condition:
                        light.is_on: master_bathroom_light_3
                      then:
                        # 조명 1,3만 켜져있음 + 환기팬 켜기
                        - uartex.write:
                            data:
                              [
                                0x30,
                                0xbc,
                                0x00,
                                0x0e,
                                0x02,
                                0x01,
                                0x00,
                                0x00,
                                0xff,
                                0x00,
                                0xff,
                                0xff,
                                0x00,
                                0x00,
                                0x00,
                                0x00,
                              ]
                            ack: [0x30, 0xdc]
                      else:
                        # 조명 1만 켜져있음 + 환기팬 켜기
                        - uartex.write:
                            data:
                              [0x30, 0xbc, 0x00, 0x0e, 0x02, 0x00, 0x00, 0x00, 0xff, 0x00, 0x00, 0xff, 0x00, 0x00, 0x00]
                            ack: [0x30, 0xdc]
          else:
            - if:
                condition:
                  light.is_on: master_bathroom_light_2
                then:
                  - if:
                      condition:
                        light.is_on: master_bathroom_light_3
                      then:
                        # 조명 2,3만 켜져있음 + 환기팬 켜기
                        - uartex.write:
                            data:
                              [
                                0x30,
                                0xbc,
                                0x00,
                                0x0e,
                                0x02,
                                0x01,
                                0x00,
                                0x00,
                                0x00,
                                0xff,
                                0xff,
                                0xff,
                                0x00,
                                0x00,
                                0x00,
                                0x00,
                              ]
                            ack: [0x30, 0xdc]
                      else:
                        # 조명 2만 켜져있음 + 환기팬 켜기
                        - uartex.write:
                            data:
                              [
                                0x30,
                                0xbc,
                                0x00,
                                0x0e,
                                0x02,
                                0x01,
                                0x00,
                                0x00,
                                0x00,
                                0xff,
                                0x00,
                                0xff,
                                0x00,
                                0x00,
                                0x00,
                                0x00,
                              ]
                            ack: [0x30, 0xdc]
                else:
                  - if:
                      condition:
                        light.is_on: master_bathroom_light_3
                      then:
                        # 조명 3만 켜져있음 + 환기팬 켜기
                        - uartex.write:
                            data:
                              [
                                0x30,
                                0xbc,
                                0x00,
                                0x0e,
                                0x02,
                                0x01,
                                0x00,
                                0x00,
                                0x00,
                                0x00,
                                0xff,
                                0xff,
                                0x00,
                                0x00,
                                0x00,
                                0x00,
                              ]
                            ack: [0x30, 0xdc]
                      else:
                        # 조명 모두 꺼져있음 + 환기팬만 켜기
                        - uartex.write:
                            data:
                              [
                                0x30,
                                0xbc,
                                0x00,
                                0x0e,
                                0x02,
                                0x01,
                                0x00,
                                0x00,
                                0x00,
                                0x00,
                                0x00,
                                0xff,
                                0x00,
                                0x00,
                                0x00,
                                0x00,
                              ]
                            ack: [0x30, 0xdc]
      - logger.log: "안방화장실 환기팬 켜짐 (조명 상태 유지)"
    turn_off_action:
      # 현재 조명 상태를 유지하면서 환기팬만 끄기
      - if:
          condition:
            light.is_on: room_2_light
          then:
            - if:
                condition:
                  light.is_on: master_bathroom_light_2
                then:
                  - if:
                      condition:
                        light.is_on: master_bathroom_light_3
                      then:
                        # 조명 1,2,3 모두 켜져있음 + 환기팬 끄기
                        - uartex.write:
                            data:
                              [
                                0x30,
                                0xbc,
                                0x00,
                                0x0e,
                                0x02,
                                0x01,
                                0x00,
                                0x00,
                                0xff,
                                0xff,
                                0xff,
                                0x00,
                                0x00,
                                0x00,
                                0x00,
                                0x00,
                              ]
                            ack: [0x30, 0xdc]
                      else:
                        # 조명 1,2만 켜져있음 + 환기팬 끄기
                        - uartex.write:
                            data:
                              [
                                0x30,
                                0xbc,
                                0x00,
                                0x0e,
                                0x02,
                                0x01,
                                0x00,
                                0x00,
                                0xff,
                                0xff,
                                0x00,
                                0x00,
                                0x00,
                                0x00,
                                0x00,
                                0x00,
                              ]
                            ack: [0x30, 0xdc]
                else:
                  - if:
                      condition:
                        light.is_on: master_bathroom_light_3
                      then:
                        # 조명 1,3만 켜져있음 + 환기팬 끄기
                        - uartex.write:
                            data:
                              [
                                0x30,
                                0xbc,
                                0x00,
                                0x0e,
                                0x02,
                                0x01,
                                0x00,
                                0x00,
                                0xff,
                                0x00,
                                0xff,
                                0x00,
                                0x00,
                                0x00,
                                0x00,
                                0x00,
                              ]
                            ack: [0x30, 0xdc]
                      else:
                        # 조명 1만 켜져있음 + 환기팬 끄기
                        - uartex.write:
                            data:
                              [
                                0x30,
                                0xbc,
                                0x00,
                                0x0e,
                                0x02,
                                0x01,
                                0x00,
                                0x00,
                                0xff,
                                0x00,
                                0x00,
                                0x00,
                                0x00,
                                0x00,
                                0x00,
                                0x00,
                              ]
                            ack: [0x30, 0xdc]
          else:
            - if:
                condition:
                  light.is_on: master_bathroom_light_2
                then:
                  - if:
                      condition:
                        light.is_on: master_bathroom_light_3
                      then:
                        # 조명 2,3만 켜져있음 + 환기팬 끄기
                        - uartex.write:
                            data:
                              [
                                0x30,
                                0xbc,
                                0x00,
                                0x0e,
                                0x02,
                                0x01,
                                0x00,
                                0x00,
                                0x00,
                                0xff,
                                0xff,
                                0x00,
                                0x00,
                                0x00,
                                0x00,
                                0x00,
                              ]
                            ack: [0x30, 0xdc]
                      else:
                        # 조명 2만 켜져있음 + 환기팬 끄기
                        - uartex.write:
                            data:
                              [
                                0x30,
                                0xbc,
                                0x00,
                                0x0e,
                                0x02,
                                0x01,
                                0x00,
                                0x00,
                                0x00,
                                0xff,
                                0x00,
                                0x00,
                                0x00,
                                0x00,
                                0x00,
                                0x00,
                              ]
                            ack: [0x30, 0xdc]
                else:
                  - if:
                      condition:
                        light.is_on: master_bathroom_light_3
                      then:
                        # 조명 3만 켜져있음 + 환기팬 끄기
                        - uartex.write:
                            data:
                              [
                                0x30,
                                0xbc,
                                0x00,
                                0x0e,
                                0x02,
                                0x01,
                                0x00,
                                0x00,
                                0x00,
                                0x00,
                                0xff,
                                0x00,
                                0x00,
                                0x00,
                                0x00,
                                0x00,
                              ]
                            ack: [0x30, 0xdc]
                      else:
                        # 조명 모두 꺼져있음 + 환기팬만 끄기
                        - uartex.write:
                            data:
                              [
                                0x30,
                                0xbc,
                                0x00,
                                0x0e,
                                0x02,
                                0x01,
                                0x00,
                                0x00,
                                0x00,
                                0x00,
                                0x00,
                                0x00,
                                0x00,
                                0x00,
                                0x00,
                                0x00,
                              ]
                            ack: [0x30, 0xdc]
      - logger.log: "안방화장실 환기팬 꺼짐 (조명 상태 유지)"
    on_turn_on:
      - logger.log: "안방화장실 환기팬 켜짐"
    on_turn_off:
      - logger.log: "안방화장실 환기팬 꺼짐"

  # 거실 전체 환풍기 (Room 0) - 0x48 디바이스 사용
  - platform: uartex
    name: "Living Room Ventilation"
    id: living_room_ventilation
    state:
      data: [0x30, 0xdc, 0x00, 0x48, 0x00]
      mask: [0xff, 0xf0, 0xff, 0xff, 0xff]
    state_on:
      offset: 12
      data: [0x40]
    state_off:
      offset: 12
      data: [0x00]
    command_on:
      data: [0x30, 0xbc, 0x00, 0x48, 0x00, 0x01, 0x00, 0x00, 0x11, 0x01, 0x00, 0x00, 0x40, 0x00, 0x00, 0x00]
      ack: [0x30, 0xdc]
    command_off:
      data: [0x30, 0xbc, 0x00, 0x48, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00]
      ack: [0x30, 0xdc]
    on_turn_on:
      - logger.log: "거실 전체 환풍기 켜짐 (0x48 디바이스)"
    on_turn_off:
      - logger.log: "거실 전체 환풍기 꺼짐 (0x48 디바이스)"

climate:
  # 거실 난방 (Room 0) - 프리셋 모드로만 제어 (전원 버튼 없음)
  - platform: uartex
    name: "Living Room Heater"
    id: living_room_heater
    visual:
      min_temperature: 10 °C
      max_temperature: 30 °C
      temperature_step: 1 °C
    state:
      data: [0x30, 0xd0, 0x00, 0x36, 0x00]
      mask: [0xff, 0xf0, 0xff, 0xff, 0xff]
    state_temperature_current:
      offset: 12
      length: 1
      precision: 0
    state_temperature_target:
      offset: 10
      length: 1
      precision: 0
    state_heat:
      offset: 8
      data: [0x11] # 난방 상태 (0x11만 체크)
    state_off:
      offset: 8
      data: [0x00] # 꺼진 상태
    state_preset_away:
      offset: 9
      data: [0x01]
    state_preset_none:
      offset: 9
      data: [0x00]
    command_heat: !lambda |-
      uint8_t target = id(living_room_heater).target_temperature;
      uint8_t preset = id(living_room_heater).preset == climate::CLIMATE_PRESET_AWAY ? 0x01 : 0x00;
      return {{0x30, 0xbc, 0x00, 0x36, 0x00, 0x01, 0x00, 0x00, 0x11, preset, target, 0x00, 0x00, 0x00, 0x00, 0x00},{0x30, 0xdc}};
    command_preset_none: !lambda |-
      uint8_t target = id(living_room_heater).target_temperature;
      return {{0x30, 0xbc, 0x00, 0x36, 0x00, 0x01, 0x00, 0x00, 0x11, 0x00, target, 0x00, 0x00, 0x00, 0x00, 0x00},{0x30, 0xdc}};
    command_preset_away: !lambda |-
      uint8_t target = id(living_room_heater).target_temperature;
      return {{0x30, 0xbc, 0x00, 0x36, 0x00, 0x01, 0x00, 0x00, 0x11, 0x01, target, 0x00, 0x00, 0x00, 0x00, 0x00},{0x30, 0xdc}};
    command_temperature: !lambda |-
      uint8_t target = x;
      uint8_t preset = id(living_room_heater).preset == climate::CLIMATE_PRESET_AWAY ? 0x01 : 0x00;
      return {{0x30, 0xbc, 0x00, 0x36, 0x00, 0x01, 0x00, 0x00, 0x11, preset, target, 0x00, 0x00, 0x00, 0x00, 0x00},{0x30, 0xdc}};
    on_state:
      - logger.log:
          format: "거실 보일러 상태 변경: 모드=%s, 목표온도=%.0f°C, 현재온도=%.0f°C, 프리셋=%s"
          args:
            - 'x.mode == CLIMATE_MODE_HEAT ? "난방" : x.mode == CLIMATE_MODE_OFF ? "꺼짐" : "알수없음"'
            - "x.target_temperature"
            - "x.current_temperature"
            - 'x.preset == CLIMATE_PRESET_AWAY ? "외출" : "일반"'

  # 안방 난방 (Room 1) - 프리셋 모드로만 제어 (전원 버튼 없음)
  - platform: uartex
    name: "Master Room Heater"
    id: master_room_heater
    visual:
      min_temperature: 10 °C
      max_temperature: 30 °C
      temperature_step: 1 °C
    state:
      data: [0x30, 0xd0, 0x00, 0x36, 0x01]
      mask: [0xff, 0xf0, 0xff, 0xff, 0xff]
    state_temperature_current:
      offset: 12
      length: 1
      precision: 0
    state_temperature_target:
      offset: 10
      length: 1
      precision: 0
    state_heat:
      offset: 8
      data: [0x11] # 난방 상태 (0x11만 체크)
    state_off:
      offset: 8
      data: [0x00] # 꺼진 상태
    state_preset_away:
      offset: 9
      data: [0x01]
    state_preset_none:
      offset: 9
      data: [0x00]
    command_heat: !lambda |-
      uint8_t target = id(master_room_heater).target_temperature;
      uint8_t preset = id(master_room_heater).preset == climate::CLIMATE_PRESET_AWAY ? 0x01 : 0x00;
      return {{0x30, 0xbc, 0x00, 0x36, 0x01, 0x01, 0x00, 0x00, 0x11, preset, target, 0x00, 0x00, 0x00, 0x00, 0x00},{0x30, 0xdc}};
    command_preset_none: !lambda |-
      uint8_t target = id(master_room_heater).target_temperature;
      return {{0x30, 0xbc, 0x00, 0x36, 0x01, 0x01, 0x00, 0x00, 0x11, 0x00, target, 0x00, 0x00, 0x00, 0x00, 0x00},{0x30, 0xdc}};
    command_preset_away: !lambda |-
      uint8_t target = id(master_room_heater).target_temperature;
      return {{0x30, 0xbc, 0x00, 0x36, 0x01, 0x01, 0x00, 0x00, 0x11, 0x01, target, 0x00, 0x00, 0x00, 0x00, 0x00},{0x30, 0xdc}};
    command_temperature: !lambda |-
      uint8_t target = x;
      uint8_t preset = id(master_room_heater).preset == climate::CLIMATE_PRESET_AWAY ? 0x01 : 0x00;
      return {{0x30, 0xbc, 0x00, 0x36, 0x01, 0x01, 0x00, 0x00, 0x11, preset, target, 0x00, 0x00, 0x00, 0x00, 0x00},{0x30, 0xdc}};
    on_state:
      - logger.log:
          format: "안방 보일러 상태 변경: 모드=%s, 목표온도=%.0f°C, 현재온도=%.0f°C, 프리셋=%s"
          args:
            - 'x.mode == CLIMATE_MODE_HEAT ? "난방" : x.mode == CLIMATE_MODE_OFF ? "꺼짐" : "알수없음"'
            - "x.target_temperature"
            - "x.current_temperature"
            - 'x.preset == CLIMATE_PRESET_AWAY ? "외출" : "일반"'
    command_update: 
      data: [0x30, 0xbc, 0x00, 0x36, 0x01, 0x01, 0x00, 0x3a, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00]
      ack: [0x30, 0xdc]
    update_interval: 2h
  # 사라 난방 (Room 3) - 프리셋 모드로만 제어 (전원 버튼 없음)
  - platform: uartex
    name: "Room 3 Heater"
    id: room3_heater
    visual:
      min_temperature: 10 °C
      max_temperature: 30 °C
      temperature_step: 1 °C
    state:
      data: [0x30, 0xd0, 0x00, 0x36, 0x03]
      mask: [0xff, 0xf0, 0xff, 0xff, 0xff]
    state_temperature_current:
      offset: 12
      length: 1
      precision: 0
    state_temperature_target:
      offset: 10
      length: 1
      precision: 0
    state_heat:
      offset: 8
      data: [0x11] # 난방 상태 (0x11만 체크)
    state_off:
      offset: 8
      data: [0x00] # 꺼진 상태
    state_preset_away:
      offset: 9
      data: [0x01]
    state_preset_none:
      offset: 9
      data: [0x00]
    command_heat: !lambda |-
      uint8_t target = id(room3_heater).target_temperature;
      uint8_t preset = id(room3_heater).preset == climate::CLIMATE_PRESET_AWAY ? 0x01 : 0x00;
      return {{0x30, 0xbc, 0x00, 0x36, 0x03, 0x01, 0x00, 0x00, 0x11, preset, target, 0x00, 0x00, 0x00, 0x00, 0x00},{0x30, 0xdc}};
    command_preset_none: !lambda |-
      uint8_t target = id(room3_heater).target_temperature;
      return {{0x30, 0xbc, 0x00, 0x36, 0x03, 0x01, 0x00, 0x00, 0x11, 0x00, target, 0x00, 0x00, 0x00, 0x00, 0x00},{0x30, 0xdc}};
    command_preset_away: !lambda |-
      uint8_t target = id(room3_heater).target_temperature;
      return {{0x30, 0xbc, 0x00, 0x36, 0x03, 0x01, 0x00, 0x00, 0x11, 0x01, target, 0x00, 0x00, 0x00, 0x00, 0x00},{0x30, 0xdc}};
    command_temperature: !lambda |-
      uint8_t target = x;
      uint8_t preset = id(room3_heater).preset == climate::CLIMATE_PRESET_AWAY ? 0x01 : 0x00;
      return {{0x30, 0xbc, 0x00, 0x36, 0x03, 0x01, 0x00, 0x00, 0x11, preset, target, 0x00, 0x00, 0x00, 0x00, 0x00},{0x30, 0xdc}};
    on_state:
      - logger.log:
          format: "옷방 보일러 상태 변경: 모드=%s, 목표온도=%.0f°C, 현재온도=%.0f°C, 프리셋=%s"
          args:
            - 'x.mode == CLIMATE_MODE_HEAT ? "난방" : x.mode == CLIMATE_MODE_OFF ? "꺼짐" : "알수없음"'
            - "x.target_temperature"
            - "x.current_temperature"
            - 'x.preset == CLIMATE_PRESET_AWAY ? "외출" : "일반"'
    command_update: 
      data: [0x30, 0xbc, 0x00, 0x36, 0x03, 0x01, 0x00, 0x3a, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00]
      ack: [0x30, 0xdc]
    update_interval: 2h

  # 세나방 난방 (Room 2) - 프리셋 모드로만 제어 (전원 버튼 없음)
  - platform: uartex
    name: "Room 2 Heater"
    id: room2_heater
    visual:
      min_temperature: 10 °C
      max_temperature: 30 °C
      temperature_step: 1 °C
    state:
      data: [0x30, 0xd0, 0x00, 0x36, 0x02]
      mask: [0xff, 0xf0, 0xff, 0xff, 0xff]
    state_temperature_current:
      offset: 12
      length: 1
      precision: 0
    state_temperature_target:
      offset: 10
      length: 1
      precision: 0
    state_heat:
      offset: 8
      data: [0x11] # 난방 상태 (0x11만 체크)
    state_off:
      offset: 8
      data: [0x00] # 꺼진 상태
    state_preset_away:
      offset: 9
      data: [0x01]
    state_preset_none:
      offset: 9
      data: [0x00]
    command_heat: !lambda |-
      uint8_t target = id(room2_heater).target_temperature;
      uint8_t preset = id(room2_heater).preset == climate::CLIMATE_PRESET_AWAY ? 0x01 : 0x00;
      return {{0x30, 0xbc, 0x00, 0x36, 0x02, 0x01, 0x00, 0x00, 0x11, preset, target, 0x00, 0x00, 0x00, 0x00, 0x00},{0x30, 0xdc}};
    command_preset_none: !lambda |-
      uint8_t target = id(room2_heater).target_temperature;
      return {{0x30, 0xbc, 0x00, 0x36, 0x02, 0x01, 0x00, 0x00, 0x11, 0x00, target, 0x00, 0x00, 0x00, 0x00, 0x00},{0x30, 0xdc}};
    command_preset_away: !lambda |-
      uint8_t target = id(room2_heater).target_temperature;
      return {{0x30, 0xbc, 0x00, 0x36, 0x02, 0x01, 0x00, 0x00, 0x11, 0x01, target, 0x00, 0x00, 0x00, 0x00, 0x00},{0x30, 0xdc}};
    command_temperature: !lambda |-
      uint8_t target = x;
      uint8_t preset = id(room2_heater).preset == climate::CLIMATE_PRESET_AWAY ? 0x01 : 0x00;
      return {{0x30, 0xbc, 0x00, 0x36, 0x02, 0x01, 0x00, 0x00, 0x11, preset, target, 0x00, 0x00, 0x00, 0x00, 0x00},{0x30, 0xdc}};
    on_state:
      - logger.log:
          format: "세나방 보일러 상태 변경: 모드=%s, 목표온도=%.0f°C, 현재온도=%.0f°C, 프리셋=%s"
          args:
            - 'x.mode == CLIMATE_MODE_HEAT ? "난방" : x.mode == CLIMATE_MODE_OFF ? "꺼짐" : "알수없음"'
            - "x.target_temperature"
            - "x.current_temperature"
            - 'x.preset == CLIMATE_PRESET_AWAY ? "외출" : "일반"'
    command_update: 
      data: [0x30, 0xbc, 0x00, 0x36, 0x02, 0x01, 0x00, 0x3a, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00]
      ack: [0x30, 0xdc]
    update_interval: 2h

  # 알파룸 난방 - 프리셋 모드로만 제어 (전원 버튼 없음)
  - platform: uartex
    name: "Alpha room Heater"
    id: Alpha_room_heater
    visual:
      min_temperature: 10 °C
      max_temperature: 30 °C
      temperature_step: 1 °C
    state:
      data: [0x30, 0xd0, 0x00, 0x36, 0x04]
      mask: [0xff, 0xf0, 0xff, 0xff, 0xff]
    state_temperature_current:
      offset: 12
      length: 1
      precision: 0
    state_temperature_target:
      offset: 10
      length: 1
      precision: 0
    state_heat:
      offset: 8
      data: [0x11] # 난방 상태 (0x11만 체크)
    state_off:
      offset: 8
      data: [0x00] # 꺼진 상태
    state_preset_away:
      offset: 9
      data: [0x01]
    state_preset_none:
      offset: 9
      data: [0x00]
    command_heat: !lambda |-
      uint8_t target = id(Alpha_room_heater).target_temperature;
      uint8_t preset = id(Alpha_room_heater).preset == climate::CLIMATE_PRESET_AWAY ? 0x01 : 0x00;
      return {{0x30, 0xbc, 0x00, 0x36, 0x04, 0x01, 0x00, 0x00, 0x11, preset, target, 0x00, 0x00, 0x00, 0x00, 0x00},{0x30, 0xdc}};
    command_preset_none: !lambda |-
      uint8_t target = id(Alpha_room_heater).target_temperature;
      return {{0x30, 0xbc, 0x00, 0x36, 0x04, 0x01, 0x00, 0x00, 0x11, 0x00, target, 0x00, 0x00, 0x00, 0x00, 0x00},{0x30, 0xdc}};
    command_preset_away: !lambda |-
      uint8_t target = id(Alpha_room_heater).target_temperature;
      return {{0x30, 0xbc, 0x00, 0x36, 0x04, 0x01, 0x00, 0x00, 0x11, 0x01, target, 0x00, 0x00, 0x00, 0x00, 0x00},{0x30, 0xdc}};
    command_temperature: !lambda |-
      uint8_t target = x;
      uint8_t preset = id(Alpha_room_heater).preset == climate::CLIMATE_PRESET_AWAY ? 0x01 : 0x00;
      return {{0x30, 0xbc, 0x00, 0x36, 0x04, 0x01, 0x00, 0x00, 0x11, preset, target, 0x00, 0x00, 0x00, 0x00, 0x00},{0x30, 0xdc}};

    on_state:
      - logger.log:
          format: "알파룸 보일러 상태 변경: 모드=%s, 목표온도=%.0f°C, 현재온도=%.0f°C, 프리셋=%s"
          args:
            - 'x.mode == CLIMATE_MODE_HEAT ? "난방" : x.mode == CLIMATE_MODE_OFF ? "꺼짐" : "알수없음"'
            - "x.target_temperature"
            - "x.current_temperature"
            - 'x.preset == CLIMATE_PRESET_AWAY ? "외출" : "일반"'

    command_update: 
      data: [0x30, 0xbc, 0x00, 0x36, 0x04, 0x01, 0x00, 0x3a, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00]
      ack: [0x30, 0xdc]
    update_interval: 2h

#for 엘리베이터 도착 문구
globals:
  - id: elevator_text_state
    type: std::string
    initial_value: '"대기"'
    
binary_sensor:
  # 현관 초인종 감지 (다양한 패턴 시도)
  - platform: uartex
    name: "Doorbell"
    icon: "mdi:doorbell"
    device_class: sound
    state:
      data: [0x30, 0xbc, 0x00, 0x60, 0x00] # 모션/도어벨 디바이스
      mask: [0xff, 0xff, 0xff, 0xff, 0xff]
    state_on:
      offset: 8
      data: [0x01]
    state_off:
      offset: 8
      data: [0x00]
    on_press:
      - logger.log: "🔔 현관 초인종이 눌렸습니다!"
    on_release:
      - logger.log: "🔔 현관 초인종 신호 종료"

  # 현관문 열림 감지 센서
  - platform: uartex
    name: "Front Door"
    icon: "mdi:door"
    device_class: door
    state:
      data: [0x30, 0xd0, 0x00, 0x60, 0x00] # 상태 조회 패턴
      mask: [0xff, 0xf0, 0xff, 0xff, 0xff]
    state_on:
      offset: 8
      data: [0x01] # 문 열림 (값 반전)
    state_off:
      offset: 8
      data: [0x00] # 문 닫힘 (값 반전)
    on_press:
      - logger.log: "� 현관문이 종열렸습니다!"
    on_release:
      - logger.log: "🚪 현관문이 닫혔습니다!"

#아래 도착오기는 옴
#  - platform: uartex
#    name: "Elevator Arrive"
#    icon: mdi:elevator
#    device_class: door
#    state:
#      data: [0x30, 0xb0, 0x00, 0x44, 0x00]
#      mask: [0xff, 0xf0, 0xff, 0xff, 0xff]
#    state_on:
#      offset: 8
#      data: [0x03]
#    # 문제 1 해결: 5초 후 자동으로 상태를 '닫힘'으로 리셋
#    filters:
#      - delayed_off: 5s
#    # 문제 2 해결: uartex에서 지원하는 표준 트리거인 on_press 사용
#    on_press:
#      then:
#        - logger.log:
#            format: "🛗 엘리베이터가 도착했습니다!"
#            level: INFO

#엘리베이터 도착했을때 나오는 패킷
#ESP Kocom Log [R]AA55 30 BE 00 44 00 01 00 01 03 0000000000000037 0D0D(21)로 변경되었습니다.
#오전 2:21:59 - 2초 후
#ESP Kocom Log [R]AA55 30 BD 00 44 00 01 00 01 03 0000000000000036 0D0D(21)로 변경되었습니다.
#오전 2:21:59 - 2초 후
#ESP Kocom Log [R]AA55 30 BC 00 44 00 01 00 01 03 0000000000000035 0D0D(21)로 변경되었습니다.
#오전 2:21:58 - 2초 후
#ESP Kocom Log [R]AA55 30 BE 00 44 00 01 00 00 03 0000000000000036 0D0D(21)로 변경되었습니다.
#오전 2:21:58 - 2초 후
#ESP Kocom Log [R]AA55 30 BD 00 44 00 01 00 00 03 0000000000000035 0D0D(21)로 변경되었습니다.
#오전 2:21:58 - 2초 후
#ESP Kocom Log [R]AA55 30 BC 00 44 00 01 00 00 03 0000000000000034 0D0D(21)로 변경되었습니다.
#오전 2:21:57 - 2초 후

  - platform: uartex
    internal: true
    id: elevator_raw
    state:
      data: [0x30, 0xb0, 0x00, 0x44, 0x00]
      mask: [0xff, 0xf0, 0xff, 0xff, 0xff]
    state_on:
      offset: 8
      data: [0x03]
    on_press:
      then:
        - lambda: 'id(elevator_text_state) = "도착";'
        - component.update: elevator_display_sensor
        - delay: 10s
        - lambda: 'id(elevator_text_state) = "대기";'
        - component.update: elevator_display_sensor

text_sensor:
  - platform: template
    name: "Elevator Status"
    id: elevator_display_sensor
    icon: mdi:elevator
    lambda: |-
      return id(elevator_text_state);

button:
  # 엘리베이터 호출
  - platform: uartex
    name: "Elevator Call"
    icon: "mdi:elevator"
    command_on:
      data: [0x30, 0xbc, 0x00, 0x01, 0x00, 0x44, 0x00, 0x01, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00]
      ack: [0x30, 0xdc]

      # 전원 공급선만 활성화 (조명은 켜지지 않음)
  - platform: template
    name: "Power Supply Activate"
    icon: "mdi:power-plug"
    on_press:
      # 전원 공급선만 활성화 - Room ID를 0x00으로 변경하여 일괄소등 방지
      - uartex.write:
          data: [0x30, 0xbc, 0x00, 0x0e, 0x00, 0x01, 0x00, 0x66, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00]
          ack: [0x30, 0xdc]
      - logger.log: "전원 공급선 활성화 (일괄소등 방지 적용)"


      
#sensor:
#  - platform: uartex
#    name: "Elevator Floors"
#    icon: "mdi:elevator"
#    unit_of_measurement: '층'
#    state: 
#      data: [0x30, 0xd0, 0x00, 0x01, 0x00, 0x44, 0x00]
#      mask: [0xff, 0xf0, 0xff, 0xff, 0xff, 0xff, 0xff]
#    state_number:
#      offset: 9
      
#text_sensor:
#  - platform: uartex
#    name: "Elevator Direction"
#    icon: "mdi:elevator"
#    state: 
#      data: [0x30, 0xd0, 0x00, 0x01, 0x00, 0x44, 0x00]
#      mask: [0xff, 0xf0, 0xff, 0xff, 0xff, 0xff, 0xff]
#    lambda: |-
#      if (check_value(8, 0x00, data, len)) return "정지";
#      if (check_value(8, 0x01, data, len)) return "하강";
#      if (check_value(8, 0x02, data, len)) return "상승";
#      if (check_value(8, 0x03, data, len)) return "도착";
#      return "Unknown";


#엘리베이터 도착했을때 나오는 패킷
#ESP Kocom Log [R]AA55 30 BE 00 44 00 01 00 01 03 0000000000000037 0D0D(21)로 변경되었습니다.
#오전 2:21:59 - 2초 후
#ESP Kocom Log [R]AA55 30 BD 00 44 00 01 00 01 03 0000000000000036 0D0D(21)로 변경되었습니다.
#오전 2:21:59 - 2초 후
#ESP Kocom Log [R]AA55 30 BC 00 44 00 01 00 01 03 0000000000000035 0D0D(21)로 변경되었습니다.
#오전 2:21:58 - 2초 후
#ESP Kocom Log [R]AA55 30 BE 00 44 00 01 00 00 03 0000000000000036 0D0D(21)로 변경되었습니다.
#오전 2:21:58 - 2초 후
#ESP Kocom Log [R]AA55 30 BD 00 44 00 01 00 00 03 0000000000000035 0D0D(21)로 변경되었습니다.
#오전 2:21:58 - 2초 후
#ESP Kocom Log [R]AA55 30 BC 00 44 00 01 00 00 03 0000000000000034 0D0D(21)로 변경되었습니다.
#오전 2:21:57 - 2초 후
#--------
#도착 다시 시도 2번째 패킷
#도착 패킷
#ESP Kocom Log [R]AA55 30 BE 00 44 00 01 00 01 03 00000000000000370D0D(21)로 변경되었습니다.
#오전 2:41:39 - 2초 후
#ESP Kocom Log [R]AA55 30 BD 00 44 00 01 00 01 03 00000000000000360D0D(21)로 변경되었습니다.
#오전 2:41:39 - 2초 후
#ESP Kocom Log [R]AA55 30 BC 00 44 00 01 00 01 03 00000000000000350D0D(21)로 변경되었습니다.<-도착?
#오전 2:41:38 - 2초 후
#ESP Kocom Log [R]AA55 30 BE 00 44 00 01 00 00 03 00000000000000360D0D(21)로 변경되었습니다.
#오전 2:41:38 - 2초 후
#ESP Kocom Log [R]AA55 30 BD 00 44 00 01 00 00 03 0000000000000350D0D(21)로 변경되었습니다.
#오전 2:41:38 - 2초 후
#ESP Kocom Log [R]AA55 30 BC 00 44 00 01 00 00 03 00000000000000340D0D(21)로 변경되었습니다.
#오전 2:41:37 - 2초 후
#-----------
#--아래는 전송 신호
#ESP Kocom Log [R]AA55 30 DC 00 44 00 01 00 01 03 00000000000000550D0D(21)로 변경되었습니다.
#오전 2:21:23 - 2초 후
#ESP Kocom Log [W]AA55 30 BC 00 01 00 44 00 01 03 00000000000000350D0D(21)로 변경되었습니다.
#오전 2:21:22 - 2초 후

#글 참고 도착 패킷
#AA55 30 BC 00 44 00 01 00 01 03 00 00 00 00 00 00 00 35 0D 0D 
#[출처] 구코콤 엘리베이터 호출 및 층수 디스플레이 추가 성공기(part 1) (HomeAssistant) | 작성자 꼬르륵
